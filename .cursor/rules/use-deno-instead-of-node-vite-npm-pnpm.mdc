---
description: Use Deno instead of Node.js, npm, pnpm, or vite.
globs: "*.ts, *.tsx, *.html, *.css, *.js, *.jsx, deno.json, deno.lock"
alwaysApply: false
---

Default to using Deno instead of Node.js.

- Use `deno run <file>` instead of `node <file>` or `ts-node <file>`
- Use `deno test` instead of `jest` or `vitest`
- Use `deno compile` to create executables instead of `pkg` or `nexe`
- Use `deno install` or `deno add` to add dependencies to `deno.json`
- Use `deno task <script>` instead of `npm run <script>` or `yarn run <script>` or `pnpm run <script>`
- Deno automatically loads .env files, so don't use dotenv.
- Deno has built-in TypeScript support, no need for `tsconfig.json` or compilation steps.

## Permission Flags

Deno is secure by default. Use explicit permission flags:

- `--allow-net` for network access
- `--allow-read` for file system read access
- `--allow-write` for file system write access
- `--allow-env` for environment variable access
- `--allow-run` for subprocess execution
- `-A` or `--allow-all` for all permissions (use sparingly)

Example: `deno run --allow-net --allow-read server.ts`

## APIs

- `Deno.serve()` for HTTP servers with WebSocket support. Don't use `express`.
- `jsr:@db/sqlite` or `npm:better-sqlite3` for SQLite.
- `npm:ioredis` for Redis (use npm: specifier for Node.js packages).
- `jsr:@db/postgres` or `npm:postgres` for Postgres.
- `WebSocket` is built-in. Don't use `ws`.
- Use `Deno.readTextFile()`/`Deno.writeTextFile()` or `Deno.readFile()`/`Deno.writeFile()` instead of `node:fs`.
- Use `Deno.Command` for spawning processes instead of `child_process`.

## Imports

Use URLs or JSR imports:

```ts
// JSR (JavaScript Registry)
import { assertEquals } from "jsr:@std/assert";

// HTTPS imports
import { serve } from "https://deno.land/std@0.224.0/http/server.ts";

// npm: specifier for Node.js packages
import express from "npm:express@4";
```

## Testing

Use `deno test` to run tests.

```ts#index.test.ts
import { assertEquals } from "jsr:@std/assert";

Deno.test("hello world", () => {
  assertEquals(1, 1);
});

Deno.test("async test", async () => {
  const result = await Promise.resolve(42);
  assertEquals(result, 42);
});
```

## HTTP Server

Use `Deno.serve()` for creating HTTP servers:

```ts#server.ts
Deno.serve({
  port: 8000,
  handler: (req) => {
    const url = new URL(req.url);
    
    if (url.pathname === "/") {
      return new Response("Hello, world!");
    }
    
    if (url.pathname.startsWith("/api/users/")) {
      const id = url.pathname.split("/").pop();
      return Response.json({ id });
    }
    
    return new Response("Not found", { status: 404 });
  },
});
```

## WebSocket Support

```ts#websocket.ts
Deno.serve({
  handler: (req) => {
    if (req.headers.get("upgrade") === "websocket") {
      const { socket, response } = Deno.upgradeWebSocket(req);
      
      socket.onopen = () => {
        socket.send("Hello, world!");
      };
      
      socket.onmessage = (event) => {
        socket.send(event.data);
      };
      
      socket.onclose = () => {
        console.log("WebSocket closed");
      };
      
      return response;
    }
    
    return new Response("Expected WebSocket connection", { status: 400 });
  },
});
```

## Frontend Development

For frontend development, use `deno serve` with the `--watch` flag for auto-reload:

```sh
deno serve --watch --allow-net --allow-read server.ts
```

You can serve static files and handle API routes:

```ts#server.ts
import { serveDir } from "jsr:@std/http/file-server";

Deno.serve((req) => {
  const url = new URL(req.url);
  
  // API routes
  if (url.pathname.startsWith("/api/")) {
    return Response.json({ message: "API response" });
  }
  
  // Serve static files from ./public
  return serveDir(req, {
    fsRoot: "./public",
  });
});
```

## deno.json Configuration

Use `deno.json` for configuration:

```json#deno.json
{
  "tasks": {
    "dev": "deno serve --watch --allow-net --allow-read --allow-env server.ts",
    "test": "deno test --allow-all",
    "start": "deno run --allow-net --allow-read --allow-env server.ts"
  },
  "imports": {
    "@std/assert": "jsr:@std/assert@^1.0.0"
  },
  "compilerOptions": {
    "strict": true
  }
}
```

For more information, visit [https://deno.com](https://deno.com) or check the Deno documentation at [https://docs.deno.com](https://docs.deno.com).
